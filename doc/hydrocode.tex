\documentclass[a4paper]{article}
% generated by Docutils <http://docutils.sourceforge.net/>
\usepackage{fixltx2e} % LaTeX patches, \textsubscript
\usepackage{cmap} % fix search and cut-and-paste in Acrobat
\usepackage{ifthen}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\setcounter{secnumdepth}{0}
\usepackage{longtable,ltcaption,array}
\setlength{\extrarowheight}{2pt}
\newlength{\DUtablewidth} % internal use in tables
\usepackage{tabularx}

%%% Custom LaTeX preamble
% PDF Standard Fonts
\usepackage{mathptmx} % Times
\usepackage[scaled=.90]{helvet}
\usepackage{courier}

%%% User specified packages and stylesheets

%%% Fallback definitions for Docutils-specific commands

% providelength (provide a length variable and set default, if it is new)
\providecommand*{\DUprovidelength}[2]{
  \ifthenelse{\isundefined{#1}}{\newlength{#1}\setlength{#1}{#2}}{}
}

% docinfo (width of docinfo table)
\DUprovidelength{\DUdocinfowidth}{0.9\textwidth}

% hyperlinks:
\ifthenelse{\isundefined{\hypersetup}}{
  \usepackage[colorlinks=true,linkcolor=blue,urlcolor=blue]{hyperref}
  \urlstyle{same} % normal text font (alternatives: tt, rm, sf)
}{}
\hypersetup{
  pdftitle={HydroCode documentation},
  pdfauthor={Joakim Kjellsson, Department of Meterology \& Bolin Centre for Climate Research, Stockholm University}
}

%%% Title Data
\title{\phantomsection%
  HydroCode documentation%
  \label{hydrocode-documentation}%
  \\ % subtitle%
  \large{A Fortran 95 code for calculating atmospheric stream functions}%
  \label{a-fortran-95-code-for-calculating-atmospheric-stream-functions}}
\author{}
\date{}

%%% Body
\begin{document}
\maketitle

% Docinfo
\begin{center}
\begin{tabularx}{\DUdocinfowidth}{lX}
\textbf{Author}: &
	Joakim Kjellsson, Department of Meterology \& Bolin Centre for Climate Research, Stockholm University \\
\textbf{Contact}: &
	\href{mailto:joakimkjellsson@gmail.com}{joakimkjellsson@gmail.com} \\
\end{tabularx}
\end{center}


\section{Compiling and running%
  \label{compiling-and-running}%
}
%
\begin{quote}{\ttfamily \raggedright \noindent
make\\
./psi.x
}
\end{quote}

Any dataset with data on terrain-following coordinates can be used.
Some models use sigma, $p_k = \sigma_k * p_s$, and some use hybrid, $p_k = a_k * p_0 + b_k * p_s$, or $p_k = a_k + b_k * p_s$.

The following data has been used
%
\begin{itemize}

\item %
\begin{description}
\item[{Reanalysis}] \leavevmode %
\begin{itemize}

\item ERA-Interim

\item MERRA

\end{itemize}

\end{description}

\item %
\begin{description}
\item[{CMIP5 models (atmosphere component only)}] \leavevmode %
\begin{itemize}

\item CanESM2

\item CCSM4

\item CNRM CM5

\item CSIRO Mk3-6-0

\item GFDL CM3

\item IPSL CM5A

\item NorESM1

\end{itemize}

\end{description}

\end{itemize}


\section{Set up%
  \label{set-up}%
}

Analysis can be controlled both via a few pre-processing flags at compile time and some values in a namelist at run time.


\subsection{Pre-processing%
  \label{pre-processing}%
}

The pre-processing flags control the kinds of data that will be saved to file.

\setlength{\DUtablewidth}{\linewidth}
\begin{longtable*}[c]{|p{0.110\DUtablewidth}|p{0.726\DUtablewidth}|}
\hline
\textbf{%
Flag
} & \textbf{%
Calculates \& Outputs
} \\
\hline
\endfirsthead
\hline
\textbf{%
Flag
} & \textbf{%
Calculates \& Outputs
} \\
\hline
\endhead
\multicolumn{2}{c}{\hfill ... continued on next page} \\
\endfoot
\endlastfoot

-Dpsixy
 & 
Barotropic stream function in lon-lat coordinates
 \\
\hline

-Dpsixz
 & 
Zonal overturning stream function in model coordinates
 \\
\hline

-Dpsixr
 & 
Zonal overturining stream function in tracer coordinates
 \\
\hline

-Dpsiyz
 & 
Meridional overturning stream function in model coordinates
 \\
\hline

-Dpsiyr
 & 
Meridional overturning stream function in tracer coordinates
 \\
\hline

-Dpsirr
 & 
Stream function in tracer-tracer coordinates
 \\
\hline
\end{longtable*}


\subsection{Namelist%
  \label{namelist}%
}

The namelist controls a variety of settings.

\setlength{\DUtablewidth}{\linewidth}
\begin{longtable*}[c]{|p{0.179\DUtablewidth}|p{0.656\DUtablewidth}|}
\hline
\textbf{%
TIME
} & \textbf{%} \\
\hline
\endfirsthead
\hline
\textbf{%
TIME
} & \textbf{%} \\
\hline
\endhead
\multicolumn{2}{c}{\hfill ... continued on next page} \\
\endfoot
\endlastfoot

yearstart
 & 
Starting year
 \\
\hline

monstart
 & 
Starting month
 \\
\hline

daystart
 & 
Starting day
 \\
\hline

hourstart
 & 
Starting hour
 \\
\hline

hourstep
 & 
Time (in hours) between model output
 \\
\hline

intsend
 & 
Number of time steps to analyse
 \\
\hline
\end{longtable*}

\setlength{\DUtablewidth}{\linewidth}
\begin{longtable*}[c]{|p{0.179\DUtablewidth}|p{0.656\DUtablewidth}|}
\hline
\textbf{%
DIR
} & \textbf{%} \\
\hline
\endfirsthead
\hline
\textbf{%
DIR
} & \textbf{%} \\
\hline
\endhead
\multicolumn{2}{c}{\hfill ... continued on next page} \\
\endfoot
\endlastfoot

inDataDir
 & 
Folder for data to be analysed
 \\
\hline

outDataDir
 & 
Folder for storing analysis output
 \\
\hline

tmpDataDir
 & 
Folder for storing temporary files, e.g. scratch disk
 \\
\hline

topoDir
 & 
Folder for topography data, e.g. grid/orography
 \\
\hline
\end{longtable*}

\setlength{\DUtablewidth}{\linewidth}
\begin{longtable*}[c]{|p{0.179\DUtablewidth}|p{0.656\DUtablewidth}|}
\hline
\textbf{%
FILE
} & \textbf{%} \\
\hline
\endfirsthead
\hline
\textbf{%
FILE
} & \textbf{%} \\
\hline
\endhead
\multicolumn{2}{c}{\hfill ... continued on next page} \\
\endfoot
\endlastfoot

project
 & 
Project to run. See list further down
 \\
\hline

prefix
 & 
Name of analysis run. Unique for each run
 \\
\hline
\end{longtable*}

\setlength{\DUtablewidth}{\linewidth}
\begin{longtable*}[c]{|p{0.179\DUtablewidth}|p{0.656\DUtablewidth}|}
\hline
\textbf{%
GRID
} & \textbf{%} \\
\hline
\endfirsthead
\hline
\textbf{%
GRID
} & \textbf{%} \\
\hline
\endhead
\multicolumn{2}{c}{\hfill ... continued on next page} \\
\endfoot
\endlastfoot

imt
 &  \\
\hline

jmt
 &  \\
\hline

km
 &  \\
\hline

mr
 &  \\
\hline

mr2
 &  \\
\hline

nrst
 &  \\
\hline

lbas
 &  \\
\hline
\end{longtable*}

\setlength{\DUtablewidth}{\linewidth}
\begin{longtable*}[c]{|p{0.179\DUtablewidth}|p{0.656\DUtablewidth}|}
\hline
\textbf{%
COORD
} & \textbf{%} \\
\hline
\endfirsthead
\hline
\textbf{%
COORD
} & \textbf{%} \\
\hline
\endhead
\multicolumn{2}{c}{\hfill ... continued on next page} \\
\endfoot
\endlastfoot

rmin
 &  \\
\hline

rmax
 &  \\
\hline

tmin
 &  \\
\hline

tmax
 &  \\
\hline

smin
 &  \\
\hline

smax
 &  \\
\hline

dmin
 &  \\
\hline

dmax
 &  \\
\hline

mmin
 &  \\
\hline

mmax
 &  \\
\hline

amin
 &  \\
\hline

amax
 &  \\
\hline
\end{longtable*}

\setlength{\DUtablewidth}{\linewidth}
\begin{longtable*}[c]{|p{0.179\DUtablewidth}|p{0.656\DUtablewidth}|}
\hline
\textbf{%
MISC
} & \textbf{%} \\
\hline
\endfirsthead
\hline
\textbf{%
MISC
} & \textbf{%} \\
\hline
\endhead
\multicolumn{2}{c}{\hfill ... continued on next page} \\
\endfoot
\endlastfoot

lverbose
 & 
Verbose mode. Show extra information
 \\
\hline

logp
 & 
Use log(pressure) instead of pressure
 \\
\hline

tweak\_tmean
 & 
Use a temporal mean e.g. daily/monthly/annual mean
 \\
\hline

tweak\_zmean
 & 
Use spatial average fields, e.g. re-grid or zonal mean.
 \\
\hline

tweak\_tend
 & 
Output local tendency results
 \\
\hline

tweak\_freq
 & 
If not 0 it controls the frequency of output
 \\
\hline
\end{longtable*}


\section{History%
  \label{history}%
}

Parts of the original code was written by Kristofer Doos to calculate the thermohaline stream function for the NEMO ocean model.
It was then adapted for the atmosphere (ERA-Interim) by Joakim Kjellsson.
%
\begin{itemize}

\item January 2012: Original atmospheric code for ERA-Interim

\item February 2013: Added OpenMP parallellisation and GRIB->netCDF conversion with CDO

\item June 2013: Added options to use time-mean and/or zonal-mean variables. Also support for EC-Earth GFDL CM3.

\item July 2013: Restructured code into different modules, subroutines, etc. Unified different versions.

\item August 2013: Added preprocessing flags to control what stream functions are outputed.

\item September 2013: Added support from CanESM2, CCSM4, IPSL-CM5A, NorESM1

\item December 2013: Added support for CSIRO-Mk-3-6-0, CNRM-CM5

\end{itemize}

\end{document}
